KISSY.add("script/scrollerv",function(c){function b(Q){var J={scrollOnEdge:true,scrollByMutipleUnit:false};for(var S in Q){J[S]=Q[S]}var M="itemIndex",t="invalidScroll",G=c.all,n=this,A=false,w=c.one(J.container),z=J.list?c.one(J.list):w.children(),g=[],B=J.listItem?z.all(J.listItem):z.children(),X,e,I=G(B[0]).outerHeight(true),H=I*(J.countPerScroll||Math.floor(w.height()/I)),m=J.scrollByMutipleUnit,E=true,Y=true,o=true,K=true,r=function(){var ac=w[0],ab=ac.scrollTop!=0,Z=ac.scrollHeight>ac.clientHeight+ac.scrollTop,aa=X>0,k=X<j()-1;if(ab!=o){o=ab;O("scrollPrev")}if(Z!=K){K=Z;O("scrollNext")}if(aa!=E){E=aa;O("goPrev")}if(k!=Y){Y=k;O("goNext")}},q=function(k,aa){var Z=n[k];if(typeof Z=="function"){Z.call(n,aa)}},O=function(k){q("onScrollStatusChange",{canGoPrev:E,canGoNext:Y,canScrollPrev:o,canScrollNext:K,name:k})},N=function(k){var Z=y(k);Z.name="beforeScroll";q("beforeScroll",Z)},U=function(k){var Z=y();Z.name=k;q("onScroll",Z)},u=function(k){if(k!=t){U("next")}r()},i=function(k){if(k!=t){U("prev")}r()},P=function(k){if(X==k){return false}k=Math.max(0,Math.min(k,g.length-1));X=k;if(e){e.removeClass("selected")}e=G(g[X]);e.addClass("selected");l();return true},x=function(ab){var aa=d(e,w),k=H/2,Z=J.scrollOnEdge?I:0;if(aa.bottom<Z){if(ab){f(k+Math.abs(aa.bottom))}else{v(k+Math.abs(aa.bottom))}}if(aa.top<Z){if(ab){f(0-k-Math.abs(aa.top))}else{V(k+Math.abs(aa.top))}}},l=function(){q("onChange",{item:e,index:X,canPrev:X>0,canNext:X<j()-1})},R=function(k,Z){if(!P(k)){return false}x(Z);r();return true},y=function(k){var aa=w[0],k=(k===undefined)?aa.scrollTop:Math.max(0,Math.min(aa.scrollHeight,k)),Z=aa.scrollHeight-aa.clientHeight-k;return{canPrev:k!=0,canNext:Z>0,nextIsEnd:Z<=H,prevIsEnd:k<=H,visibleItems:s(k)}},s=function(aa){var af=w[0],ac=(aa===undefined)?af.scrollTop:aa,ab=af.clientHeight,Z=af.scrollHeight,k=j(),ad=Math.floor(k*ac/Z),ae=Math.floor(k*(Z-ac-ab)/Z);return g.slice(ad,k-ae)},j=function(){return g.length},D=function(){return e},F=function(){return e.data(M)},f=function(k){var aa=w[0],Z=aa.scrollTop;if(m){k=Math.round(k/I)*I}aa.scrollTop+=k;if(aa.scrollTop!=Z){U(k>0?"next":"prev")}r()},v=function(k){var aa=w[0],Z=aa.scrollTop,k=k||H;if(aa.scrollHeight>aa.clientHeight+aa.scrollTop){if(m){k=Math.round(k/I)*I}N(Z+k);a(aa,Z,Z+k,u)}else{u(t)}},V=function(k){var aa=w[0],Z=aa.scrollTop,k=k||H;if(Z>0){if(m){k=Math.round(k/I)*I}N(Z-k);a(aa,Z,Z-k,i)}else{i(t)}},L=function(k){g=g.concat([].slice.call(G(k).appendTo(z),0));T();r();return g.length-1},C=function(Z){var Z=G(Z),k=Z.prependTo(z).length;g=[].slice.call(Z,0).concat(g);T();w[0].scrollTop+=I*k;X+=k;r();return 0},h=function(k){var Z=g.splice(k,1);G(Z).remove();if(!g.length){q("onEmpty");return}X=-1;P(k);T();r();q("onItemDeleted",{name:"deleted",visibleItems:s()})},T=function(){c.each(g,function(Z,k){G(Z).data(M,k)})},p=function(Z){var k=X;if(Z){if(k>0){k-=1}}else{if(k<g.length-1){k+=1}}R(k)},W=function(){c.each(B,function(Z,k){g[k]=Z});T();w.on("click",function(k){var Z=G(k.target);if(J.listItem&&Z.test(J.listItem)||!J.listItem&&Z.parent()[0]===z[0]){R(Z.data(M))}})};n.selectItemByIndex=R;n.getSelectedItem=D;n.getSelectedIndex=F;n.scrollNext=v;n.scrollPrev=V;n.appendItem=L;n.prependItem=C;n.removeItemByIndex=h;n.goNext=p;n.goPrev=function(){p(true)};n.init=function(k){if(A){return n}R(k,true);U("init");A=true};W()}function a(k,j,h,i){var h=Math.min(k.scrollHeight-k.clientHeight,Math.max(h,0)),e=h-j,f=Math.abs(e),g=f>50?(e/5):(e>0?5:-5);if(f>Math.abs(g)){j+=g;k.scrollTop=j;setTimeout(function(){a(k,j,h,i)},10)}else{k.scrollTop=h;if(typeof i=="function"){i()}}}function d(g,e){var h=g.offset(),f=e.offset();return{left:h.left-f.left,right:(f.left+e.width())-(h.left+g.width()),top:h.top-f.top,bottom:(f.top+e.height())-(h.top+g.height())}}return b},{requires:["event","node"]});
